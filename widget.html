<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meteo Widget NYC Live FA</title>
<!-- Font Awesome CDN -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
  body {
    margin: 0;
    padding: 0;
    background: transparent;
  }
  .widget {
    width: 250px;
    height: 167px;
    background: #A1A538;
    color: #202020;
    border-radius: 5px;
    font-family: system-ui, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    box-sizing: border-box;
  }
  h2 {
    font-size: 1rem;
    margin: 0 0 5px;
  }
  .temp {
    font-size: 2rem;
    font-weight: bold;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .temp i {
    font-size: 40px;
    color: #F3EEEE;
  }
  .desc {
    font-size: 0.9rem;
    margin-top: 3px;
  }
</style>
</head>
<body>
  <div class="widget">
    <h2>New York City</h2>
    <div class="temp">
      <span id="temp">-- °C</span>
      <i id="icon" class="fas fa-sun"></i>
    </div>
    <div class="desc" id="desc">Caricamento...</div>
  </div>

<script>
// Mappatura codici Open-Meteo → classi Font Awesome
const weatherFAclass = {
  0: ["fa-sun", "fa-moon"],           // Sereno Giorno / Notte
  1: ["fa-cloud-sun", "fa-cloud-moon"], // Poco nuvoloso Giorno / Notte
  2: ["fa-cloud-sun", "fa-cloud-moon"], // Variabile
  3: ["fa-cloud", "fa-cloud"],         // Nuvoloso
  45: ["fa-smog", "fa-smog"],          // Nebbia
  48: ["fa-smog", "fa-smog"],          // Nebbia con brina
  51: ["fa-cloud-rain", "fa-cloud-rain"], // Pioviggine leggera
  53: ["fa-cloud-showers-heavy", "fa-cloud-showers-heavy"], // Pioviggine moderata
  55: ["fa-cloud-showers-heavy", "fa-cloud-showers-heavy"], // Pioviggine intensa
  61: ["fa-cloud-rain", "fa-cloud-moon-rain"], // Pioggia leggera
  63: ["fa-cloud-showers-heavy", "fa-cloud-showers-heavy"], // Pioggia moderata
  65: ["fa-cloud-bolt", "fa-cloud-bolt"], // Pioggia intensa
  71: ["fa-snowflake", "fa-snowflake"], // Neve leggera
  73: ["fa-snowflake", "fa-snowflake"], // Neve moderata
  75: ["fa-snowflake", "fa-snowflake"], // Neve intensa
  95: ["fa-cloud-bolt", "fa-cloud-bolt"] // Temporale
};

// Descrizione meteo
const descMapping = {
  0: "Sereno",
  1: "Poco nuvoloso",
  2: "Variabile",
  3: "Nuvoloso",
  45: "Nebbia",
  48: "Nebbia con brina",
  51: "Pioviggine leggera",
  53: "Pioviggine moderata",
  55: "Pioviggine intensa",
  61: "Pioggia leggera",
  63: "Pioggia moderata",
  65: "Pioggia intensa",
  71: "Neve leggera",
  73: "Neve moderata",
  75: "Neve intensa",
  95: "Temporale"
};

// Giorno/notte
function isDay() {
  const hour = new Date().getHours();
  return hour >= 6 && hour < 18;
}

// Recupera e aggiorna meteo
async function getWeather() {
  const lat = 40.7128, lon = -74.0060;
  try {
    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=America/New_York`);
    const data = await res.json();

    const temp = Math.round(data.current_weather.temperature);
    const code = data.current_weather.weathercode;

    const day = isDay() ? 0 : 1;
    const iconClass = weatherFAclass[code] ? weatherFAclass[code][day] : "fa-sun";

    const iconEl = document.getElementById("icon");
    iconEl.className = "fas " + iconClass;

    document.getElementById("temp").textContent = `${temp} °C`;
    document.getElementById("desc").textContent = descMapping[code] || "N/D";
  } catch (err) {
    console.error("Errore nel recupero del meteo:", err);
    document.getElementById("desc").textContent = "Errore dati";
  }
}

// Prima chiamata immediata
getWeather();

// Aggiorna ogni 10 minuti
setInterval(getWeather, 600000);
</script>
</body>
</html>
